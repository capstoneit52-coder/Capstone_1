import{r as c,a as u,j as e}from"./index-C1vRPJdq.js";const k=[{value:"full_time",label:"Full-time"},{value:"part_time",label:"Part-time"},{value:"locum",label:"Locum"}],S=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],b=[{key:"sun",label:"Sun"},{key:"mon",label:"Mon"},{key:"tue",label:"Tue"},{key:"wed",label:"Wed"},{key:"thu",label:"Thu"},{key:"fri",label:"Fri"},{key:"sat",label:"Sat"}];function $(){const j={id:null,dentist_code:"",dentist_name:"",is_pseudonymous:!0,employment_type:"full_time",status:"active",contract_end_date:"",sun:!1,mon:!0,tue:!0,wed:!0,thu:!0,fri:!0,sat:!1},[x,w]=c.useState([]),[C,f]=c.useState(!0),[_,N]=c.useState(!1),[p,D]=c.useState(""),[s,r]=c.useState(j),[n,m]=c.useState({}),[E,o]=c.useState(!1),[h,g]=c.useState(!1);c.useEffect(()=>{y()},[]);const y=async()=>{try{f(!0);const t=await u.get("/api/dentists");w(t.data)}catch(t){console.error(t),alert("Failed to load dentists. Check admin auth and routes.")}finally{f(!1)}},v=c.useMemo(()=>{const t=p.trim().toLowerCase();return t?x.filter(a=>(a.dentist_code||"").toLowerCase().includes(t)||(a.dentist_name||"").toLowerCase().includes(t)||(a.employment_type||"").toLowerCase().includes(t)||(a.status||"").toLowerCase().includes(t)):x},[x,p]),M=()=>{r(j),m({}),g(!1),o(!0)},L=t=>{r({id:t.id,dentist_code:t.dentist_code||"",dentist_name:t.dentist_name||"",is_pseudonymous:!!t.is_pseudonymous,employment_type:t.employment_type||"full_time",status:t.status||"active",contract_end_date:t.contract_end_date||"",sun:!!t.sun,mon:!!t.mon,tue:!!t.tue,wed:!!t.wed,thu:!!t.thu,fri:!!t.fri,sat:!!t.sat}),m({}),g(!0),o(!0)},F=()=>{const t={};return s.dentist_code.trim()||(t.dentist_code="Dentist code is required."),k.find(l=>l.value===s.employment_type)||(t.employment_type="Invalid employment type."),S.find(l=>l.value===s.status)||(t.status="Invalid status."),b.some(l=>!!s[l.key])||(t.weekdays="Select at least one working day."),s.contract_end_date&&!/^\d{4}-\d{2}-\d{2}$/.test(s.contract_end_date)&&(t.contract_end_date="Use YYYY-MM-DD format."),m(t),Object.keys(t).length===0},T=async t=>{var a,l;if(t.preventDefault(),!!F()){N(!0);try{const d={dentist_code:s.dentist_code.trim(),dentist_name:((a=s.dentist_name)==null?void 0:a.trim())||null,is_pseudonymous:!!s.is_pseudonymous,employment_type:s.employment_type,status:s.status,contract_end_date:s.contract_end_date||null,sun:!!s.sun,mon:!!s.mon,tue:!!s.tue,wed:!!s.wed,thu:!!s.thu,fri:!!s.fri,sat:!!s.sat};h&&s.id?(await u.put(`/api/dentists/${s.id}`,d),alert("Dentist updated.")):(await u.post("/api/dentists",d),alert("Dentist created.")),o(!1),y()}catch(d){const i=(l=d==null?void 0:d.response)==null?void 0:l.data;i!=null&&i.errors?m(i.errors):alert((i==null?void 0:i.message)||"Save failed")}finally{N(!1)}}},Y=async t=>{var a,l;if(confirm(`Delete dentist ${t.dentist_code}? This cannot be undone.`))try{await u.delete(`/api/dentists/${t.id}`),alert("Deleted."),y()}catch(d){alert(((l=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:l.message)||"Delete failed.")}},A=({on:t,label:a})=>e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs border ${t?"bg-green-50 border-green-300":"bg-gray-50 border-gray-200 text-gray-400"}`,children:a});return e.jsxs("div",{className:"p-4 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Dentists"}),e.jsx("button",{onClick:M,className:"rounded-xl px-3 py-2 border bg-white hover:bg-gray-50",children:"+ Add Dentist"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{className:"w-full md:w-80 border rounded-lg px-3 py-2",placeholder:"Search code / name / type / status",value:p,onChange:t=>D(t.target.value)})}),C?e.jsx("div",{children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Code"}),e.jsx("th",{className:"p-2 border",children:"Name"}),e.jsx("th",{className:"p-2 border",children:"Pseudonymous"}),e.jsx("th",{className:"p-2 border",children:"Employment"}),e.jsx("th",{className:"p-2 border",children:"Status"}),e.jsx("th",{className:"p-2 border",children:"Weekdays"}),e.jsx("th",{className:"p-2 border",children:"Contract End"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsxs("tbody",{children:[v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border font-medium",children:t.dentist_code}),e.jsx("td",{className:"p-2 border",children:t.dentist_name||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 border",children:t.is_pseudonymous?"Yes":"No"}),e.jsx("td",{className:"p-2 border",children:t.employment_type}),e.jsx("td",{className:"p-2 border",children:t.status}),e.jsx("td",{className:"p-2 border",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:b.map(a=>e.jsx(A,{on:!!t[a.key],label:a.label},a.key))})}),e.jsx("td",{className:"p-2 border",children:t.contract_end_date||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border",onClick:()=>L(t),children:"Edit"}),e.jsx("button",{className:"px-2 py-1 rounded border",onClick:()=>Y(t),children:"Delete"})]})})]},t.id)),v.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-center text-gray-500",colSpan:8,children:"No dentists found."})})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:h?"Edit Dentist":"Add Dentist"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500",children:"✕"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Dentist Code",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:s.dentist_code,onChange:t=>r({...s,dentist_code:t.target.value})}),n.dentist_code&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(n.dentist_code)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Dentist Name (optional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:s.dentist_name,onChange:t=>r({...s,dentist_name:t.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isPseudo",type:"checkbox",checked:!!s.is_pseudonymous,onChange:t=>r({...s,is_pseudonymous:t.target.checked})}),e.jsx("label",{htmlFor:"isPseudo",className:"text-sm",children:"Use pseudonymous identity?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Employment Type",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:s.employment_type,onChange:t=>r({...s,employment_type:t.target.value}),children:k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),n.employment_type&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(n.employment_type)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:s.status,onChange:t=>r({...s,status:t.target.value}),children:S.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),n.status&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(n.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Contract End (optional)"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:s.contract_end_date||"",onChange:t=>r({...s,contract_end_date:t.target.value})}),n.contract_end_date&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(n.contract_end_date)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Working Days",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s[t.key],onChange:a=>r({...s,[t.key]:a.target.checked})}),e.jsx("span",{children:t.label})]},t.key))}),n.weekdays&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(n.weekdays)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"px-3 py-2 rounded border",onClick:()=>o(!1),children:"Cancel"}),e.jsx("button",{disabled:_,type:"submit",className:"px-3 py-2 rounded border bg-black text-white disabled:opacity-50",children:_?"Saving…":h?"Save Changes":"Create"})]})]})]})})]})}export{$ as default};
